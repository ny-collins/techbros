<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechBros Library</title>
    
    <meta name="description" content="Offline-first educational resource library with P2P file sharing.">
    <meta name="theme-color" content="#0a0a0c">

    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" href="/favicon.png">

    <script src="/theme_init.js"></script>

    <link rel="stylesheet" href="/fonts/inter.css">
    <link rel="stylesheet" href="/src/style.css">
    <link rel="stylesheet" href="/vendor/phosphor/regular.css">
    <link rel="stylesheet" href="/vendor/phosphor/bold.css">
    <link rel="stylesheet" href="/vendor/phosphor/fill.css">
    <link rel="stylesheet" href="/vendor/phosphor/duotone.css">

    <script src="/vendor/peerjs.min.js"></script>
</head>
<body>
    <!-- Skip to main content link for screen readers -->
    <a href="#main-content" class="skip-link visually-hidden" tabindex="1">Skip to main content</a>

    <div id="splash-screen" role="status" aria-live="polite">
        <div class="splash-content">
            <img src="/favicon.png" alt="TechBros Logo" class="splash-logo">
            <h1 class="splash-title">TechBros</h1>
            <p class="splash-tagline">Offline-First Education Platform</p>
            
            <div class="splash-loader">
                <div class="loader-bar">
                    <div class="loader-progress" id="splash-progress"></div>
                </div>
                <p class="splash-status" id="splash-status">Initializing...</p>
            </div>

            <div class="splash-error hidden" id="splash-error">
                <i class="ph ph-warning-circle"></i>
                <p>Failed to load application</p>
                <button class="btn small primary" onclick="location.reload()">Retry</button>
            </div>

            <button class="splash-skip" id="splash-skip" aria-label="Skip splash screen">
                <span>Press ESC to skip</span>
            </button>

            <small class="splash-version">v3.0.0</small>
        </div>
    </div>

    <div id="app" class="app-container">
        
        <aside id="main-sidebar" class="sidebar">
            <div class="brand-wrapper">
                <div id="brand-toggle" class="brand" role="button" tabindex="0" aria-label="Toggle Sidebar">
                    <img src="/favicon.png" alt="Logo" class="logo">
                    <h1>TechBros</h1>
                </div>
                <button id="sidebar-close" class="btn-icon sidebar-close-btn" aria-label="Close Sidebar">
                    <i class="ph ph-x"></i>
                </button>
            </div>

            <nav class="nav-menu">
                <a href="#library" class="nav-link active">
                    <i class="ph ph-books"></i> <span>Library</span>
                </a>
                <a href="#p2p" class="nav-link">
                    <i class="ph ph-share-network"></i> <span>P2P Share</span>
                </a>
                <a href="#export" class="nav-link">
                    <i class="ph ph-download"></i> <span>Export Data</span>
                </a>
                <a href="#about" class="nav-link">
                    <i class="ph ph-info"></i> <span>About</span>
                </a>
                <a href="#help" class="nav-link">
                    <i class="ph ph-question"></i> <span>Help</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div id="p2p-status" class="status-indicator neutral">
                    <span class="dot"></span> <span class="text">Offline</span>
                </div>
                <small id="app-version-sidebar">v3.0.0</small>
            </div>
        </aside>

        <div id="sidebar-overlay" class="sidebar-overlay"></div>

        <main id="main-content" class="main-content" role="main" aria-label="Application content">
            
            <header id="main-header" class="top-bar">
                <div class="top-bar-left">
                    <button id="mobile-menu-toggle" class="btn-icon mobile-only" aria-label="Open Menu">
                        <i class="ph ph-list"></i>
                    </button>
                    <div class="search-container">
                        <i class="ph ph-magnifying-glass search-icon" aria-hidden="true"></i>
                        <label for="search-input" class="visually-hidden">Search Library</label>
                        <input type="text" id="search-input" placeholder="Search library..." 
                               role="searchbox" aria-describedby="search-help">
                        <div id="search-help" class="visually-hidden">Search through your library of resources</div>
                    </div>
                </div>
                
                <div class="actions">
                    <button id="btn-clear-cache" class="btn-icon tooltip" data-tooltip="Clear Cache">
                        <i class="ph ph-trash"></i>
                    </button>
                    <button id="theme-toggle" class="btn-icon" aria-label="Toggle Theme">
                        <i class="ph ph-moon"></i>
                    </button>
                </div>
            </header>

            <section id="library-view" class="view-section active">
                <div class="library-header">
                    <div class="header-text">
                        <h2>Library</h2>
                        <p class="subtitle">Your offline collection</p>
                    </div>
                    <div class="view-toggles">
                        <button id="view-grid" class="btn-icon active" title="Grid View"><i class="ph ph-squares-four"></i></button>
                        <button id="view-list" class="btn-icon" title="List View"><i class="ph ph-list-dashes"></i></button>
                    </div>
                </div>

                <div class="filter-chips" id="filter-container"></div>
                
                <div id="resource-list" class="resource-grid"></div>
            </section>

            <section id="resource-view" class="view-section">
                <div class="player-header">
                    <button id="btn-back-library" class="btn-back">
                        <i class="ph ph-arrow-left"></i> <span>Back</span>
                    </button>
                </div>
                <div id="player-container" class="player-container"></div>
            </section>

            <section id="p2p-view" class="view-section">
                <!-- Phase 1: Handshake (Connection) -->
                <div id="p2p-handshake-view" class="p2p-container">
                    <div class="header-text center">
                        <h2>AirShare</h2>
                        <p class="subtitle">Fast, serverless file sharing & chat</p>
                    </div>

                    <div class="p2p-role-selection">
                        <button id="btn-role-host" class="role-card">
                            <div class="icon-wrapper"><i class="ph ph-broadcast"></i></div>
                            <h3>Receive</h3>
                            <p>Host a session</p>
                        </button>
                        <button id="btn-role-join" class="role-card">
                            <div class="icon-wrapper"><i class="ph ph-paper-plane-right"></i></div>
                            <h3>Send</h3>
                            <p>Join a session</p>
                        </button>
                    </div>

                    <div id="host-panel" class="p2p-panel hidden">
                        <button class="btn-back-role"><i class="ph ph-arrow-left"></i> Back</button>
                        
                        <div class="connection-guide">
                            <div class="guide-step">
                                <i class="ph ph-wifi-high"></i>
                                <p><strong>Step 1:</strong> Ensure the sender is on your Wi-Fi or Hotspot.</p>
                            </div>
                        </div>

                        <div class="p2p-identity-card">
                            <div class="radar-container">
                                <div class="radar-scan"></div>
                                <div class="radar-scan delay-1"></div>
                                <div class="pin-wrapper">
                                    <span class="label">MY SIGNAL</span>
                                    <span id="my-pin-display" class="code">....</span>
                                    <button id="btn-copy-pin" class="btn-copy-pin" title="Copy PIN">
                                        <i class="ph ph-copy"></i>
                                    </button>
                                </div>
                            </div>
                            <p class="instruction">Share this PIN with the sender</p>
                            
                            <div class="manual-mode-toggle">
                                <input type="checkbox" id="manual-mode-switch-host">
                                <label for="manual-mode-switch-host">Show Offline QR Code</label>
                            </div>
                            <div id="host-qr-display" class="qr-display hidden"></div>
                        </div>
                    </div>

                    <div id="join-panel" class="p2p-panel hidden">
                        <button class="btn-back-role"><i class="ph ph-arrow-left"></i> Back</button>

                        <div class="connection-guide">
                            <div class="guide-step">
                                <i class="ph ph-link"></i>
                                <p><strong>Step 1:</strong> Connect to the Receiver's Wi-Fi or Hotspot.</p>
                            </div>
                        </div>

                        <div class="p2p-card">
                            <h3>Enter Host PIN</h3>
                            <div class="connection-form">
                                <input type="text" pattern="[0-9]*" inputmode="numeric" id="remote-pin" placeholder="ENTER PIN" maxlength="4" autofocus>
                                <button id="btn-connect" class="btn primary">Connect</button>
                            </div>
                            
                            <div class="divider"><span>OR</span></div>
                            
                            <button id="btn-scan-qr" class="btn secondary full-width">
                                <i class="ph ph-qr-code"></i> Scan Offline QR
                            </button>
                            <div id="qr-reader" class="hidden"></div>
                        </div>
                    </div>
                </div>

                <!-- Phase 2: Dashboard (Exchange) -->
                <div id="p2p-dashboard-view" class="p2p-dashboard hidden">
                    <div class="dashboard-header">
                        <div class="connection-status">
                            <span class="status-dot"></span>
                            <span id="dashboard-status-text">Connected to Peer</span>
                        </div>
                        <button id="btn-disconnect" class="btn-icon danger small" title="Disconnect">
                            <i class="ph ph-power"></i>
                        </button>
                    </div>

                    <div id="transfer-feed" class="transfer-feed">
                        <div class="system-message">Connection established. You can now share files and chat.</div>
                    </div>

                    <div class="dashboard-footer chat-footer">
                        <div class="chat-input-wrapper">
                            <button id="btn-attach" class="btn-icon attachment-btn" title="Send File">
                                <i class="ph ph-plus"></i>
                            </button>
                            <div class="chat-input-container">
                                <input type="text" id="chat-msg-input" placeholder="Type a message..." autocomplete="off">
                            </div>
                            <button id="btn-send-chat" class="btn-icon send-btn" title="Send Message">
                                <i class="ph ph-paper-plane-right-fill"></i>
                            </button>
                        </div>
                        <input type="file" id="file-upload" hidden>
                    </div>
                </div>
            </section>

            <section id="export-view" class="view-section">
                <div class="header-text">
                    <h2><i class="ph ph-database"></i> Export Data</h2>
                    <p class="subtitle">Download and manage your local data</p>
                </div>
                
                <div class="settings-list">
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-icon">
                                <i class="ph ph-gear-six"></i>
                            </div>
                            <div class="setting-content">
                                <h3>Settings Backup</h3>
                                <p>Download a JSON file containing your theme preferences, layout settings, and search history. Useful when moving to a new device.</p>
                            </div>
                        </div>
                        <button id="btn-export-settings" class="btn primary small">
                            <i class="ph ph-download-simple"></i> Export JSON
                        </button>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-icon">
                                <i class="ph ph-list-bullets"></i>
                            </div>
                            <div class="setting-content">
                                <h3>Library Catalog</h3>
                                <p>Generate a complete manifest of all files currently stored in your offline library. This list can be shared with others to compare collections.</p>
                            </div>
                        </div>
                        <button id="btn-export-catalog" class="btn secondary small">
                            <i class="ph ph-file-text"></i> Export Catalog
                        </button>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-icon">
                                <i class="ph ph-database"></i>
                            </div>
                            <div class="setting-content">
                                <h3>Storage Information</h3>
                                <p id="storage-info">Calculating storage usage...</p>
                            </div>
                        </div>
                        <button id="btn-clear-all-data" class="btn danger small">
                            <i class="ph ph-trash"></i> Clear All Data
                        </button>
                    </div>
                </div>
            </section>

            <section id="about-view" class="view-section">
                <div class="header-text">
                    <div class="about-header-content">
                        <img src="/favicon.png" alt="TechBros" class="about-logo">
                        <div>
                            <h2>TechBros Library</h2>
                            <p class="subtitle">Offline-first educational platform</p>
                        </div>
                    </div>
                </div>

                <div class="about-content">
                    <div class="about-block">
                        <div class="block-header">
                            <i class="ph-bold ph-target"></i>
                            <h3>Mission</h3>
                        </div>
                        <p>Education shouldn't depend on your internet connection. TechBros provides an offline-first platform where educational resources—PDFs, videos, and audio—live permanently on your device, accessible anytime, anywhere.</p>
                    </div>

                    <div class="about-block">
                        <div class="block-header">
                            <i class="ph-bold ph-sparkle"></i>
                            <h3>Key Features</h3>
                        </div>
                        
                        <div class="feature-grid">
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="ph-bold ph-books"></i>
                                </div>
                                <h4>Smart Library</h4>
                                <p>Organize and search your entire collection with fuzzy search. Supports PDF, MP4, and MP3 files.</p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="ph-bold ph-wifi-slash"></i>
                                </div>
                                <h4>Works Offline</h4>
                                <p>Once downloaded, everything works without internet. Perfect for remote areas or limited data plans.</p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="ph-bold ph-share-network"></i>
                                </div>
                                <h4>P2P Transfer</h4>
                                <p>Share files directly between devices without internet. Transfer large files in seconds.</p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="ph-bold ph-file-pdf"></i>
                                </div>
                                <h4>Built-in Viewers</h4>
                                <p>View PDFs, play videos and audio without leaving the app. Everything integrated.</p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="ph-bold ph-shield-check"></i>
                                </div>
                                <h4>Privacy First</h4>
                                <p>All data stored locally on your device. No tracking, no analytics, no cloud sync required.</p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="ph-bold ph-devices"></i>
                                </div>
                                <h4>Progressive Web App</h4>
                                <p>Install as a native app on any device. Works on phones, tablets, and desktops.</p>
                            </div>
                        </div>
                    </div>

                    <div class="about-block">
                        <div class="block-header">
                            <i class="ph-bold ph-users-three"></i>
                            <h3>Who Uses TechBros?</h3>
                        </div>
                        <div class="user-types">
                            <div class="user-type">
                                <i class="ph-bold ph-student"></i>
                                <div>
                                    <strong>Students</strong>
                                    <p>Carry your entire curriculum in your pocket</p>
                                </div>
                            </div>
                            <div class="user-type">
                                <i class="ph-bold ph-chalkboard-teacher"></i>
                                <div>
                                    <strong>Educators</strong>
                                    <p>Distribute materials to students effortlessly</p>
                                </div>
                            </div>
                            <div class="user-type">
                                <i class="ph-bold ph-globe"></i>
                                <div>
                                    <strong>Remote Learners</strong>
                                    <p>Learn without boundaries or buffering</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="about-block">
                        <div class="block-header">
                            <i class="ph-bold ph-download"></i>
                            <h3>Installation</h3>
                        </div>
                        <p>For the best experience, install TechBros as a native app on your device.</p>
                        <div class="install-action" id="install-container">
                            <button id="btn-install-pwa" class="btn primary hidden">
                                <i class="ph ph-download-simple"></i> Install App
                            </button>
                        </div>
                    </div>

                    <div class="about-footer">
                        <div class="version-info">
                            <span id="app-version-about">Version 3.0.0</span>
                            <span class="separator">•</span>
                            <span>Built with <i class="ph-fill ph-heart" style="color: var(--danger);"></i> by <strong>Collins Mwangi</strong></span>
                        </div>
                        <div class="footer-links">
                            <a href="https://github.com/ny-collins/techbros" target="_blank" rel="noopener noreferrer" class="btn secondary small">
                                <i class="ph ph-github-logo"></i> View Source
                            </a>
                            <a href="https://github.com/ny-collins/techbros/issues" target="_blank" rel="noopener noreferrer" class="btn secondary small">
                                <i class="ph ph-bug"></i> Report Issue
                            </a>
                        </div>
                    </div>
                </div>
            </section>

             <section id="help-view" class="view-section">
                <div class="header-text">
                    <h2><i class="ph ph-question"></i> Help Center</h2>
                    <p class="subtitle">Quick guides to get you started</p>
                </div>

                <div class="help-list">
                    <div class="help-item">
                        <div class="help-icon">
                            <i class="ph-bold ph-books"></i>
                        </div>
                        <div class="help-content">
                            <h3>Using the Library</h3>
                            <p>Your library is the main view where all your resources are displayed. Here's how to navigate:</p>
                            <ul>
                                <li><strong>Search:</strong> Use the search bar at the top to find resources instantly. Search works even with typos.</li>
                                <li><strong>View Modes:</strong> Switch between Grid <i class="ph ph-squares-four"></i> and List <i class="ph ph-list-dashes"></i> views using the toggles.</li>
                                <li><strong>Filter by Type:</strong> Click the filter chips (All, PDF, Video, Audio) to show specific file types.</li>
                                <li><strong>Open Resource:</strong> Click any resource card to open it in the built-in viewer.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="help-item">
                        <div class="help-icon">
                            <i class="ph-bold ph-file-pdf"></i>
                        </div>
                        <div class="help-content">
                            <h3>Viewing Resources</h3>
                            <p>TechBros has built-in viewers for all supported file types:</p>
                            <ul>
                                <li><strong>PDFs:</strong> Navigate with arrow keys or page buttons. Zoom in/out with controls.</li>
                                <li><strong>Videos:</strong> Full video player with play/pause, seeking, and playback speed controls.</li>
                                <li><strong>Audio:</strong> Audio player with waveform visualization and playback controls.</li>
                                <li><strong>Close Viewer:</strong> Press ESC or click the X button to return to library.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="help-item">
                        <div class="help-icon">
                            <i class="ph-bold ph-share-network"></i>
                        </div>
                        <div class="help-content">
                            <h3>P2P File Sharing</h3>
                            <p>Share files directly between devices without internet:</p>
                            
                            <div class="help-subsection">
                                <h4>To Receive a File:</h4>
                                <ol>
                                    <li>Go to the <strong>P2P Share</strong> page</li>
                                    <li>Share your <strong>Signal PIN</strong> (4 digits) with the sender</li>
                                    <li>Wait for the sender to connect</li>
                                    <li>Accept the incoming file transfer</li>
                                    <li>Click <strong>Save to Device</strong> when transfer completes</li>
                                </ol>
                            </div>

                            <div class="help-subsection">
                                <h4>To Send a File:</h4>
                                <ol>
                                    <li>Go to the <strong>P2P Share</strong> page and click <strong>Send</strong></li>
                                    <li>Enter the receiver's <strong>Signal PIN</strong></li>
                                    <li>Click <strong>Connect</strong></li>
                                    <li>Once connected, drag and drop your file or click to select</li>
                                    <li>Wait for the transfer to complete</li>
                                </ol>
                            </div>

                            <div class="help-tip">
                                <i class="ph ph-info"></i>
                                <p><strong>Note:</strong> P2P requires a brief internet connection for the initial handshake between devices. After that, the actual file transfer happens directly without using internet.</p>
                            </div>
                        </div>
                    </div>

                    <div class="help-item">
                        <div class="help-icon">
                            <i class="ph-bold ph-cloud-arrow-up"></i>
                        </div>
                        <div class="help-content">
                            <h3>Adding Resources</h3>
                            <p>There are two ways to add resources to your library:</p>
                            <ul>
                                <li><strong>Cloud Upload:</strong> Requires admin PIN. Contact the administrator to upload files to the cloud library that sync to all devices.</li>
                                <li><strong>P2P Transfer:</strong> Receive files directly from other users via the P2P Share feature. These are stored locally on your device only.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="help-item">
                        <div class="help-icon">
                            <i class="ph-bold ph-wifi-slash"></i>
                        </div>
                        <div class="help-content">
                            <h3>Offline Mode</h3>
                            <p>TechBros is designed to work completely offline:</p>
                            <ul>
                                <li>All resources you've accessed are cached automatically</li>
                                <li>The app interface works without internet</li>
                                <li>Resources from P2P transfers are stored locally</li>
                                <li>Only the initial cloud resource list requires internet</li>
                            </ul>
                        </div>
                    </div>

                    <div class="help-item">
                        <div class="help-icon">
                            <i class="ph-bold ph-gear-six"></i>
                        </div>
                        <div class="help-content">
                            <h3>Settings & Customization</h3>
                            <ul>
                                <li><strong>Theme:</strong> Click the moon/sun icon <i class="ph ph-moon"></i> in the top bar to switch between dark and light modes.</li>
                                <li><strong>Clear Cache:</strong> Use the trash icon <i class="ph ph-trash"></i> in the top bar to clear cached data.</li>
                                <li><strong>Export Data:</strong> Go to the Export Data page to download your settings or library catalog.</li>
                                <li><strong>View Layout:</strong> Your preferred view mode (grid/list) is saved automatically.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="help-item">
                        <div class="help-icon">
                            <i class="ph-bold ph-keyboard"></i>
                        </div>
                        <div class="help-content">
                            <h3>Keyboard Shortcuts</h3>
                            <div class="shortcuts-grid">
                                <div class="shortcut">
                                    <kbd>ESC</kbd>
                                    <span>Close viewer or modal</span>
                                </div>
                                <div class="shortcut">
                                    <kbd>←</kbd> <kbd>→</kbd>
                                    <span>Navigate PDF pages</span>
                                </div>
                                <div class="shortcut">
                                    <kbd>Space</kbd>
                                    <span>Play/Pause media</span>
                                </div>
                                <div class="shortcut">
                                    <kbd>Ctrl</kbd> + <kbd>F</kbd>
                                    <span>Focus search</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="help-item">
                        <div class="help-icon">
                            <i class="ph-bold ph-warning"></i>
                        </div>
                        <div class="help-content">
                            <h3>Troubleshooting</h3>
                            <ul>
                                <li><strong>Resources not loading:</strong> Check your internet connection and refresh the page.</li>
                                <li><strong>P2P connection failing:</strong> Both devices need internet for the initial connection. Try sharing PINs again.</li>
                                <li><strong>Video not playing:</strong> Ensure the video format is supported (MP4). Try clearing cache.</li>
                                <li><strong>App slow or crashing:</strong> Clear cache to free up space. Go to Export Data → Clear All Data.</li>
                                <li><strong>Still having issues?</strong> Report bugs on <a href="https://github.com/ny-collins/techbros/issues" target="_blank" rel="noopener noreferrer">GitHub Issues</a>.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <div id="confirmation-overlay" class="confirmation-overlay hidden">
        <div class="confirmation-dialog">
            <p id="confirmation-message">Are you sure?</p>
            <div class="confirmation-actions">
                <button id="btn-confirm-cancel" class="btn secondary">Cancel</button>
                <button id="btn-confirm-ok" class="btn danger">Confirm</button>
            </div>
        </div>
    </div>

    <div id="pin-modal" class="confirmation-overlay hidden">
        <div class="confirmation-dialog">
            <h3>Admin Access</h3>
            <p>Enter PIN to upload files</p>
            <form id="pin-form">
                <div class="pin-input-wrapper">
                    <input type="password" id="upload-pin-input" placeholder="****" maxlength="4" class="pin-field" autocomplete="off">
                </div>
                <div class="confirmation-actions">
                    <button type="button" id="btn-pin-cancel" class="btn secondary">Cancel</button>
                    <button type="submit" id="btn-pin-confirm" class="btn primary">Unlock</button>
                </div>
            </form>
        </div>
    </div>

    <div id="toast-container"></div>
    <div id="notification-area"></div>

    <script type="module" src="/src/app.js"></script>

</body>
</html>