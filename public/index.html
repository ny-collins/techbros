<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechBros Library</title>
    
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta name="theme-color" content="#1a1a1a">

    <link rel="stylesheet" href="/style.css">
    
    <!-- Phosphor Icons -->
    <link rel="stylesheet" href="/vendor/phosphor/regular.css">
    <link rel="stylesheet" href="/vendor/phosphor/bold.css">
    <link rel="stylesheet" href="/vendor/phosphor/fill.css">
    <link rel="stylesheet" href="/vendor/phosphor/duotone.css">

    <script src="/vendor/peerjs.min.js"></script>
</head>
<body>

    <!-- Custom Splash Screen -->
    <div id="splash-screen">
        <div class="splash-content">
            <img src="/favicon.png" alt="TechBros Logo" class="splash-logo">
            <h1 class="splash-title">TechBros</h1>
            <p class="splash-subtitle">Offline Library</p>
        </div>
    </div>

    <div class="app-container">
        
        <!-- Sidebar Navigation -->
        <aside id="main-sidebar" class="sidebar">
            <div class="brand-wrapper">
                <!-- Brand acts as Toggle -->
                <div id="brand-toggle" class="brand" role="button" tabindex="0" aria-label="Toggle Sidebar">
                    <img src="/favicon.png" alt="Logo" class="logo">
                    <h1>TechBros</h1>
                </div>
                <!-- Close Button -->
                <button id="sidebar-close" class="btn-icon sidebar-close-btn" aria-label="Close Sidebar">
                    <i class="ph ph-x"></i>
                </button>
            </div>

            <nav class="nav-menu">
                <a href="#library" class="nav-link active">
                    <i class="ph ph-books"></i> <span>Library</span>
                </a>
                <a href="#p2p" class="nav-link">
                    <i class="ph ph-share-network"></i> <span>P2P Share</span>
                </a>
                <a href="#export" class="nav-link">
                    <i class="ph ph-download"></i> <span>Export Data</span>
                </a>
                <a href="#about" class="nav-link">
                    <i class="ph ph-info"></i> <span>About</span>
                </a>
                <a href="#help" class="nav-link">
                    <i class="ph ph-question"></i> <span>Help</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div id="p2p-status" class="status-indicator neutral">
                    <span class="dot"></span> <span class="text">Offline</span>
                </div>
                <small id="app-version-sidebar">v...</small>
            </div>
        </aside>

        <!-- Overlay for Mobile/Click-away -->
        <div id="sidebar-overlay" class="sidebar-overlay"></div>

        <!-- Main Content Area -->
        <main class="main-content">
            
            <!-- Header -->
            <header id="main-header" class="top-bar">
                <div class="top-bar-left">
                    <button id="mobile-menu-toggle" class="btn-icon mobile-only" aria-label="Open Menu">
                        <i class="ph ph-list"></i>
                    </button>
                    <div class="search-container">
                        <i class="ph ph-magnifying-glass"></i>
                        <input type="text" id="search-input" placeholder="Search resources...">
                    </div>
                </div>
                
                <div class="actions">
                    <button id="btn-clear-cache" class="btn-icon tooltip" data-tooltip="Clear local storage & cache" aria-label="Clear Cache">
                        <i class="ph ph-trash"></i>
                    </button>
                    <button id="theme-toggle" class="btn-icon" aria-label="Toggle Theme">
                        <i class="ph ph-moon"></i>
                    </button>
                </div>
            </header>

            <!-- VIEW: Library -->
            <section id="library-view" class="view-section active">
                <div class="section-header">
                    <h2>Library Resources</h2>
                    <div class="header-actions">
                        <button id="view-grid" class="btn-icon active" title="Grid View"><i class="ph ph-squares-four"></i></button>
                        <button id="view-list" class="btn-icon" title="List View"><i class="ph ph-list-dashes"></i></button>
                    </div>
                </div>
                
                <div id="resource-list" class="resource-grid">
                    <!-- Skeleton Loader -->
                    <div class="skeleton-card"></div>
                    <div class="skeleton-card"></div>
                    <div class="skeleton-card"></div>
                </div>
            </section>

            <!-- VIEW: Resource Player -->
            <section id="resource-view" class="view-section">
                <div class="player-header">
                    <button id="btn-back-library" class="btn-back">
                        <i class="ph ph-arrow-left"></i> Back to Library
                    </button>
                </div>
                
                <div id="player-container" class="player-container">
                    <!-- Injected Content Goes Here -->
                </div>
            </section>

            <!-- VIEW: P2P Sharing -->
            <section id="p2p-view" class="view-section">
                <div class="p2p-container">
                    
                    <div class="p2p-section center-text">
                        <h3>My Identity</h3>
                        <p style="margin-bottom: 1rem; color: var(--text-secondary);">Share this unique PIN with others on your local network to receive files directly.</p>
                        <div class="pin-display">
                            <span class="label">MY PIN</span>
                            <span id="my-pin-display" class="code">....</span>
                        </div>
                    </div>

                    <div class="p2p-grid">
                        <div class="p2p-col">
                            <div class="p2p-header">
                                <div class="icon-circle"><i class="ph ph-paper-plane-right"></i></div>
                                <h4>Send File</h4>
                            </div>
                            <div class="p2p-body">
                                <p>To send a file, make sure the receiving device is on the "P2P Share" page. Ask for their 4-digit PIN.</p>
                                <div class="input-group">
                                    <input type="number" id="remote-pin" placeholder="0000" maxlength="4">
                                    <button id="btn-connect" class="btn primary">Connect</button>
                                </div>
                                <p style="font-size:0.9rem; color:var(--text-secondary)">Once connected, a "Select File" button will appear.</p>
                                <input type="file" id="file-upload" hidden>
                                <button id="btn-send-file" class="btn secondary full-width" style="display:none">
                                    <i class="ph ph-file-plus"></i> Select File
                                </button>
                            </div>
                        </div>

                        <div class="p2p-col">
                            <div class="p2p-header">
                                <div class="icon-circle"><i class="ph ph-download-simple"></i></div>
                                <h4>Receive Queue</h4>
                            </div>
                            <div class="p2p-body">
                                <p>Incoming connection requests and file transfers will appear here automatically. Keep this page open.</p>
                                <div id="transfer-status" class="transfer-log">
                                    <em>Waiting for connection...</em>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </section>

            <!-- VIEW: Export Data -->
            <section id="export-view" class="view-section">
                <h2>Export Data</h2>
                
                <div class="info-section">
                    <h3>Export Settings</h3>
                    <p>Download your current application preferences, including theme choices and layout settings. You can import this JSON file on another device to restore your configuration.</p>
                    <button class="btn secondary">Download Settings JSON</button>
                </div>

                <div class="info-section">
                    <h3>Export Resource List</h3>
                    <p>Generate a complete manifest of all resources currently indexed in your library. This includes file names, sizes, and media types. Useful for backing up your catalog structure or sharing your library index with others.</p>
                    <button class="btn secondary">Download Catalog JSON</button>
                </div>
            </section>

            <!-- VIEW: About -->
            <section id="about-view" class="view-section">
                <h2>About TechBros</h2>
                
                <div class="info-section">
                    <h3>Mission</h3>
                    <p>TechBros Library is an offline-first Progressive Web Application designed to democratize access to educational resources to users with limited internet connectivity. Our "Download Once, Read Forever" model ensures that knowledge is accessible to everyone, everywhere, regardless of infrastructure.</p>
                </div>

                <div class="info-section">
                    <h3>Features</h3>
                    <ul>
                        <li><strong>Offline-First Architecture:</strong> Resources are cached immediately upon access.</li>
                        <li><strong>P2P AirShare:</strong> Transfer files between devices without internet using WebRTC.</li>
                        <li><strong>Universal Viewer:</strong> Integrated support for PDFs, MP4 Videos, and Audio files.</li>
                        <li><strong>Responsive Design:</strong> Optimized for Mobile, Tablet, and Desktop environments.</li>
                    </ul>
                </div>

                <div class="info-section">
                    <h3>Open Source</h3>
                    <p>This project is open source and available for contribution.</p>
                    <a href="https://github.com/ny-collins/techbros" target="_blank" class="btn secondary">
                        <i class="ph ph-github-logo"></i> View Source on GitHub
                    </a>
                </div>

                <div class="info-section">
                    <h3>Developer</h3>
                    <p><strong>Collins Mwangi</strong></p>
                    <p id="app-version-about">Version ...</p>
                </div>
            </section>

             <!-- VIEW: Help -->
             <section id="help-view" class="view-section">
                <h2>Help & FAQ</h2>
                
                <div class="info-section">
                    <h3>How do I share files?</h3>
                    <ol style="margin-left: 1.5rem; color: var(--text-secondary); line-height: 1.8;">
                        <li>Navigate to the <strong>P2P Share</strong> tab.</li>
                        <li>Ensure the person you want to send to is also on the P2P Share tab on their device.</li>
                        <li>Ask them for their <strong>4-digit PIN</strong> displayed at the top of their screen.</li>
                        <li>Enter that PIN in the "Receiver's PIN" box on your screen.</li>
                        <li>Click <strong>Connect</strong>.</li>
                        <li>Once the connection is established (you'll see a green notification), click <strong>Select File</strong>.</li>
                        <li>Choose the file you want to send. The transfer will begin immediately.</li>
                    </ol>
                </div>

                <div class="info-section">
                    <h3>How do I receive files?</h3>
                    <p>Simply open the <strong>P2P Share</strong> tab. Your unique 4-digit PIN is displayed prominently at the top. Share this number verbally or visually with the person sending the file. You don't need to do anything else; the transfer will appear in your "Receive Queue" automatically.</p>
                </div>

                <div class="info-section">
                    <h3>Does this really work offline?</h3>
                    <p>Yes. The first time you visit this website, it installs itself onto your device. After that, you can turn off your Wi-Fi and data, and the app will still load. Any PDF or video you have opened previously is stored in a special "Cache" on your device, making it available without internet.</p>
                </div>

                <div class="info-section">
                    <h3>Troubleshooting Connections</h3>
                    <p>If P2P connection fails:</p>
                    <ul>
                        <li>Ensure both devices are on the same Wi-Fi network (preferred) or have some internet access for the initial handshake.</li>
                        <li>Check if a firewall or VPN is blocking WebRTC.</li>
                        <li>Refresh the page on both devices to generate new PINs and try again.</li>
                    </ul>
                </div>
            </section>

        </main>
    </div>

    <div id="notification-area"></div>
    <script type="module" src="/app.js"></script>

</body>
</html>